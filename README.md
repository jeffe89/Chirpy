# Chirpy

**Chirpy** is a lightweight Twitter-like platform that allows users to register, post short messages ("chirps"), and interact via a simple REST API. It features secure user authentication, token refresh logic, and webhook handling for external events.

---

## 🚀 Project Structure Overview

```
chirpy/
├── main.go
├── handler_*.go
├── internal/
│   ├── auth/
│   └── database/
├── sql/
│   ├── queries/
│   └── schema/
├── assets/
├── index.html
```

---

## 🔧 Main Components

### `main.go`
- Entry point of the application.
- Sets up the HTTP server and registers all the route handlers.
- Initializes dependencies like the database and logger.

### `metrics.go`
- Exposes metrics (hit count) for monitoring.

### `readiness.go`
- Health and readiness probe handler for container orchestration systems.

### `reset.go`
- Utility handler used to reset the application database state.

### `json.go`
- Provides helper functions for encoding/decoding JSON and sending consistent HTTP responses.

---

## 🧩 Handlers (API Endpoints)

These are organized into individual Go files for modularity:

### `handler_users_create.go`
- **POST /api/users**
- Registers a new user with email and password.

### `handler_users_update.go`
- **PUT /api/users**
- Allows a logged-in user to update their email or password.

### `handler_login.go`
- **POST /api/login**
- Authenticates a user and returns an access and refresh token.

### `handler_refresh.go`
- **POST /api/refresh**
- Issues a new access token using a valid refresh token.

### `handler_chirps_create.go`
- **POST /api/chirps**
- Allows authenticated users to create a chirp.

### `handler_chirps_get.go`
- **GET /api/chirps`
- Returns a list of chirps, optionally filtered by user ID.

### `handler_chirps_delete.go`
- **DELETE /api/chirps/{id}**
- Allows the author of a chirp to delete it.

### `handler_webhooks.go`
- **POST /api/webhooks**
- Receives event data from external sources like payment processors.

---

## 🔐 Internal Packages

### `internal/auth/auth.go`
- Handles JWT creation and validation.
- Includes logic for access and refresh tokens, with configurable lifetimes.

### `internal/database/db.go`
- Manages PostgreSQL database connections and transactions.

### `internal/database/*.sql.go`
Auto-generated by `sqlc`, these files handle typed query execution for:

- `users.sql.go`: User registration, login, update.
- `chirps.sql.go`: Chirp creation, retrieval, deletion.
- `refresh_tokens.sql.go`: Token lifecycle management.
- `reset.sql.go`: Utility query to reset all data (used in testing or admin workflows).

---

## 🗃️ SQL Directory

### `sql/schema/*.sql`
- Raw SQL files that define and evolve the PostgreSQL database schema.

### `sql/queries/*.sql`
- Contains parameterized queries parsed by `sqlc` to generate type-safe Go methods.

---

## 🖼️ Assets

### `index.html`
- Simple HTML landing page placeholder, could be used for frontend preview.

### `assets/logo.png`
- Static logo image used in the site or emails.

---

## ✅ Environment Setup

Required environment variables are listed in `.env`. These typically include:

- `JWT_SECRET`
- `DATABASE_URL`
- `SERVER_ADDRESS`

---

## 🧪 Testing

Test files like `auth_test.go` ensure the JWT logic is functioning as intended.

---

## 📄 License

See `LICENSE` for details.

---

## 🛠️ Build & Run

```bash
go run main.go
```

---

## 📝 Final Notes

Chirpy is modular, extensible, and written with clean API design and security in mind. It’s a great starter codebase for learning web backends or launching a small social platform.


---

## 🧰 Installation Instructions

### Prerequisites
- Go 1.18 or later
- PostgreSQL
- [sqlc](https://docs.sqlc.dev/en/stable/overview/install.html) (for regenerating query code if needed)

### 1. Clone the Repository
```bash
git clone https://github.com/yourusername/chirpy.git
cd chirpy
```

### 2. Configure Environment
Create a `.env` file in the root directory:
```
JWT_SECRET=your-secret-key
DATABASE_URL=postgresql://user:password@localhost:5432/chirpydb
SERVER_ADDRESS=:8080
```

### 3. Apply Database Schema
```bash
psql chirpydb < sql/schema/001_users.sql
psql chirpydb < sql/schema/002_chirps.sql
psql chirpydb < sql/schema/003_passwords.sql
psql chirpydb < sql/schema/004_refresh_tokens.sql
psql chirpydb < sql/schema/005_chirpy_red.sql
```

### 4. Build and Run
```bash
go run main.go
```

---

## 📡 API Usage Examples

All requests should be made to `http://localhost:8080`.

### 🔐 Register User
**POST** `/api/users`

```json
{
  "email": "user@example.com",
  "password": "yourpassword"
}
```

### 🔐 Login
**POST** `/api/login`

Returns access and refresh tokens.

### ✍️ Create Chirp
**POST** `/api/chirps`

Headers:
```
Authorization: Bearer <ACCESS_TOKEN>
```

Body:
```json
{
  "body": "Hello from Chirpy!"
}
```

### 📥 Get Chirps
**GET** `/api/chirps`

Optional query: `author_id=<user_id>`

### 🗑 Delete Chirp
**DELETE** `/api/chirps/{id}`

Headers:
```
Authorization: Bearer <ACCESS_TOKEN>
```

### ♻️ Refresh Token
**POST** `/api/refresh`

Body:
```json
{
  "refresh_token": "<REFRESH_TOKEN>"
}
```

---

## 🧼 Reset Data
**POST** `/api/reset`

Primarily used for testing or admin environments.

---


---

## 🖼️ System Diagrams

### 🔄 User Interaction Flow

![User Interaction Flow](flow_diagram.png)

### 🗃️ Database Schema Overview

![Database Schema](schema_diagram.png)

---
